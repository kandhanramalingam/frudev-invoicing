<app-header title="">
    <div actions class="flex gap-2 items-end">
        <div class="flex flex-col">
            <label class="text-xs mb-1">Search</label>
            <input pInputText type="text" [(ngModel)]="searchTerm" (keyup.enter)="loadData()" placeholder="Search species" />
        </div>
        <p-button
                size="small"
                label="Add Species"
                (onClick)="openDrawer()"
                class="p-button-sm">
        </p-button>
    </div>
</app-header>

<p-table
        [value]="species"
        [loading]="loading"
        [paginator]="true"
        [rows]="rowsPerPage"
        [totalRecords]="totalRecords"
        [lazy]="true"
        (onLazyLoad)="onPageChange($event)"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries">

    <ng-template pTemplate="header">
        <tr>
            <th>Name <i class="fa fa-filter text-gray-400 ml-1"></i></th>
            <th>Category</th>
            <th>Status</th>
            <th style="width: 6rem">Actions</th>
        </tr>
    </ng-template>

    <ng-template pTemplate="body" let-item>
        <tr>
            <td>
                <div>{{ item.engName }}</div>
                <div class="text-xs text-gray-500">{{ item.afcName }}</div>
            </td>
            <td>{{ item.categoryName || '-' }}</td>
            <td>
          <span [class]="item.status === 'Y' ? 'text-green-600' : 'text-red-600'">
            {{ item.status === 'Y' ? 'Active' : 'Inactive' }}
          </span>
            </td>
            <td>
                <button 
                  class="p-2 hover:bg-gray-100 rounded-full"
                  (click)="selectedSpecies = item; menu.toggle($event)">
                  <i class="fa fa-ellipsis-v text-gray-500"></i>
                </button>
                <p-menu [model]="getMenuItems(item)" appendTo="body" #menu [popup]="true">
                  <ng-template pTemplate="item" let-item>
                      <a pRipple class="flex items-center p-menu-item-link">
                          <span [class]="item.icon" [ngClass]="item.styleClass"></span>
                          <span class="ml-2" [ngClass]="item.styleClass">{{ item.label }}</span>
                      </a>
                  </ng-template>
                </p-menu>
            </td>
        </tr>
    </ng-template>
</p-table>

<p-drawer [(visible)]="drawerVisible" [header]="editMode ? 'Edit Species' : 'Add Species'" position="right" [style]="{width: '450px'}">
  <div class="space-y-4">
    <div>
      <label class="block text-sm font-medium mb-2">English Name <span class="text-red-500">*</span></label>
      <input pInputText [(ngModel)]="currentSpecies.engName" placeholder="Enter English name" class="w-full" required />
    </div>

    <div>
      <label class="block text-sm font-medium mb-2">Afrikaans Name</label>
      <input pInputText [(ngModel)]="currentSpecies.afcName" placeholder="Enter Afrikaans name" class="w-full" />
    </div>

    <div>
      <label class="block text-sm font-medium mb-2">Category</label>
      <p-select
        [(ngModel)]="currentSpecies.category_id"
        [options]="categories"
        optionLabel="name"
        optionValue="id"
        placeholder="Select category"
        class="w-full">
      </p-select>
    </div>

    <div>
      <label class="block text-sm font-medium mb-2">Status</label>
      <p-select
        [(ngModel)]="currentSpecies.status"
        [options]="statusOptions"
        optionLabel="label"
        optionValue="value"
        class="w-full">
      </p-select>
    </div>
    
    <div class="flex gap-2 pt-4">
      <p-button 
        [label]="editMode ? 'Update' : 'Save'" 
        (click)="saveSpecies()" 
        size="small"></p-button>
      <p-button 
        label="Cancel" 
        severity="secondary" 
        (click)="drawerVisible = false"
        size="small"></p-button>
    </div>
  </div>
</p-drawer>

<p-confirmDialog></p-confirmDialog>