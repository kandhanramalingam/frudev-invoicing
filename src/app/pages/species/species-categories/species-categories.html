<app-header title="">
    <div actions class="flex gap-2 items-end">
        <div class="flex flex-col">
            <label class="text-xs mb-1">Search</label>
            <input pInputText type="text" [(ngModel)]="searchTerm" (keyup.enter)="loadData()" placeholder="Search categories" />
        </div>
        <p-button
                size="small"
                label="Add Category"
                icon="pi pi-plus"
                (onClick)="openDrawer()"
                class="p-button-sm">
        </p-button>
    </div>
</app-header>

<p-table
        [value]="categories"
        [loading]="loading"
        [paginator]="true"
        [rows]="rowsPerPage"
        [totalRecords]="totalRecords"
        [lazy]="true"
        (onLazyLoad)="onPageChange($event)"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        styleClass="p-datatable-sm">

    <ng-template pTemplate="header">
        <tr>
            <th>Name <i class="fa fa-filter text-gray-400 ml-1"></i></th>
            <th>Actions</th>
        </tr>
    </ng-template>

    <ng-template pTemplate="body" let-item>
        <tr>
            <td>{{ item.name }}</td>
            <td>
                <button 
                  class="p-2 hover:bg-gray-100 rounded-full"
                  (click)="selectedCategory = item; menu.toggle($event)">
                  <i class="fa fa-ellipsis-v text-gray-500"></i>
                </button>
                <p-menu [model]="getMenuItems(item)" appendTo="body" #menu [popup]="true">
                  <ng-template pTemplate="item" let-item>
                      <a pRipple class="flex items-center p-menu-item-link">
                          <span [class]="item.icon" [ngClass]="item.styleClass"></span>
                          <span class="ml-2" [ngClass]="item.styleClass">{{ item.label }}</span>
                      </a>
                  </ng-template>
                </p-menu>
            </td>
        </tr>
    </ng-template>
</p-table>

<p-drawer [(visible)]="drawerVisible" [header]="editMode ? 'Edit Category' : 'Add Category'" position="right" [style]="{width: '400px'}">
  <div class="space-y-4">
    <div>
      <label class="block text-sm font-medium mb-2">Name <span class="text-red-500">*</span></label>
      <input pInputText [(ngModel)]="currentCategory.name" placeholder="Enter category name" class="w-full" required />
    </div>
    
    <div class="flex gap-2 pt-4">
      <p-button 
        [label]="editMode ? 'Update' : 'Save'" 
        (click)="saveCategory()" 
        size="small"></p-button>
      <p-button 
        label="Cancel" 
        severity="secondary" 
        (click)="drawerVisible = false"
        size="small"></p-button>
    </div>
  </div>
</p-drawer>

<p-confirmDialog></p-confirmDialog>